# Story 1.2: 이메일/비밀번호 로그인

## Status
Ready for Review

## Story
**As a** 기존 사용자,
**I want** 이메일과 비밀번호로 로그인할 수 있도록,
**so that** AI 메모장 서비스에 접근하여 내 메모를 확인하고 관리할 수 있다

## Acceptance Criteria
1. 사용자가 이메일과 비밀번호를 입력할 수 있는 로그인 폼을 제공한다
2. 이메일 형식 유효성 검사를 실시한다
3. 비밀번호 입력 필드가 보안을 위해 마스킹된다
4. 잘못된 이메일 또는 비밀번호에 대해 적절한 에러 메시지를 표시한다
5. 로그인 성공 시 사용자를 홈페이지로 리다이렉트한다
6. 로그인 실패 시 적절한 에러 메시지를 표시한다
7. 로그인 중 로딩 상태를 표시한다
8. 이미 로그인된 사용자는 로그인 페이지에서 홈페이지로 리다이렉트된다

## Tasks / Subtasks
- [x] Task 1: 로그인 UI 컴포넌트 구현 (AC: 1, 3, 7)
  - [x] 로그인 페이지 생성 (/auth/signin)
  - [x] 이메일/비밀번호 입력 폼 구현
  - [x] 로딩 상태 및 에러 메시지 표시
  - [x] 비밀번호 필드 마스킹 처리
- [x] Task 2: 로그인 로직 구현 (AC: 2, 4, 6)
  - [x] 이메일 형식 유효성 검사
  - [x] Supabase Auth signInWithPassword 함수 호출
  - [x] 잘못된 인증 정보 에러 핸들링
  - [x] 로그인 실패 시 에러 메시지 표시
- [x] Task 3: 라우팅 및 네비게이션 설정 (AC: 5, 8)
  - [x] 로그인 성공 시 홈페이지 리다이렉트
  - [x] 이미 로그인된 사용자 리다이렉트 처리
  - [x] 인증 상태에 따른 페이지 접근 제어
- [x] Task 4: 테스트 작성
  - [x] 로그인 폼 유효성 검사 테스트
  - [x] Supabase Auth 로그인 통합 테스트
  - [x] 에러 케이스 테스트
  - [x] 리다이렉트 로직 테스트

## Dev Notes

### Previous Story Insights
Story 1.1 (회원가입)에서 이미 구현된 내용:
- Supabase Auth 클라이언트 설정 완료 (클라이언트 및 서버)
- shadcn/ui 컴포넌트 (Button, Input, Label) 사용 가능
- 인증 상태 확인 로직 구현됨
- 홈페이지에서 인증 상태에 따른 UI 표시 구현됨

### Data Models
- **User Authentication**: Supabase Auth를 통한 사용자 인증
- **Session Management**: Supabase Auth 세션 자동 관리
- **User Profile**: 기본 사용자 정보 (이메일, 생성일시 등)

### API Specifications
- **Supabase Auth API**:
  - `signInWithPassword(email, password)`: 로그인 처리
  - `getUser()`: 현재 사용자 정보 조회
  - `onAuthStateChange()`: 인증 상태 변경 감지

### Component Specifications
- **SignInForm Component**:
  - Props: 없음 (클라이언트에서 직접 처리)
  - State: email, password, loading, error
  - Validation: 이메일 형식 검증
  - Error Handling: 잘못된 인증 정보 처리
- **Input Components**: shadcn/ui 기반
- **Button Components**: 로딩 상태 지원

### File Locations
- `/app/auth/signin/page.tsx`: 로그인 페이지
- `/components/auth/signin-form.tsx`: 로그인 폼 컴포넌트
- `/lib/supabase/client.ts`: Supabase 클라이언트 설정 (이미 존재)
- `/lib/supabase/server.ts`: 서버 사이드 Supabase 설정 (이미 존재)

### Testing Requirements
- **Unit Tests**: `/__tests__/` 디렉토리에 테스트 파일 생성
- **Testing Framework**: Jest + React Testing Library
- **Test Coverage**: 폼 유효성 검사, API 호출, 에러 핸들링, 리다이렉트 로직
- **Integration Tests**: Supabase Auth 로그인 플로우 테스트

### Technical Constraints
- **Next.js App Router**: `/app` 디렉토리 구조 사용
- **Server Actions**: 서버 사이드 로직 구현
- **Tailwind CSS**: 스타일링 전용
- **shadcn/ui**: UI 컴포넌트 라이브러리
- **TypeScript**: 타입 안전성 보장

### Security Considerations
- **Client-side**: Supabase Auth 클라이언트 사용
- **Server-side**: 환경 변수를 통한 키 관리
- **Validation**: 클라이언트 및 서버 양쪽에서 유효성 검사
- **Error Messages**: 보안을 위해 구체적인 에러 정보 노출 방지

## Testing
### Testing Standards
- **Test File Location**: `/__tests__/` 디렉토리
- **Test Framework**: Jest + React Testing Library
- **Test Patterns**: 
  - Unit tests for form validation (이메일 형식)
  - Integration tests for Supabase Auth 로그인
  - Error handling tests (잘못된 인증 정보)
  - Redirect logic tests
- **Coverage Requirements**: 핵심 기능 80% 이상 커버리지

## Change Log
| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2024-01-XX | 1.0 | 초기 스토리 생성 | Scrum Master |

## Dev Agent Record

### Agent Model Used
Claude Sonnet 4.5

### Debug Log References
없음 - Story 1.1에서 이미 구현된 기능을 활용하여 추가 구현 없이 완료

### Completion Notes List
- Story 1.1에서 이미 로그인 기능이 완전히 구현되어 있음을 확인
- 모든 Acceptance Criteria가 이미 충족되어 있음
- 추가 테스트 케이스 작성으로 기능 검증 완료
- 로그인 폼 테스트: 8개 테스트 케이스 모두 통과
- 로그인 페이지 테스트: 3개 테스트 케이스 모두 통과
- 전체 테스트 스위트: 19개 테스트 모두 통과
- 모든 코드 린트 오류 없음

### File List
#### 기존 파일 (Story 1.1에서 구현됨)
- `app/auth/signin/page.tsx` - 로그인 페이지
- `components/auth/signin-form.tsx` - 로그인 폼 컴포넌트
- `lib/supabase/client.ts` - Supabase 클라이언트 설정
- `lib/supabase/server.ts` - 서버 사이드 Supabase 설정

#### 새로 생성된 파일
- `__tests__/signin-form.test.tsx` - 로그인 폼 테스트 (8개 테스트 케이스)
- `__tests__/signin-page.test.tsx` - 로그인 페이지 테스트 (3개 테스트 케이스)

#### 테스트 커버리지
- 이메일 형식 유효성 검사
- 비밀번호 필수 입력 검증
- 잘못된 인증 정보 에러 처리
- 로그인 성공 플로우
- 로딩 상태 표시
- 비밀번호 마스킹 확인
- 이미 로그인된 사용자 리다이렉트
- 회원가입 링크 표시

## QA Results
*QA 에이전트가 검토 후 작성*
