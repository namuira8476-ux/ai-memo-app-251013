# Story 1.5: 신규 사용자 온보딩 플로우

## Status
Draft

## Story
**As a** 신규 가입 사용자,
**I want** 직관적인 온보딩 경험을 통해 AI 메모장의 핵심 기능을 이해하고,
**so that** 처음 사용할 때 혼란 없이 빠르게 앱을 활용할 수 있다

## Acceptance Criteria
1. 신규 회원가입 완료 후 자동으로 온보딩 플로우가 시작된다
2. 온보딩은 3단계(웰컴, 핵심 기능 소개, 첫 메모 작성 안내)로 구성된다
3. 각 단계에서 다음/건너뛰기 버튼이 제공된다
4. 온보딩 완료 후 메인 페이지(노트 목록)로 이동한다
5. 온보딩 건너뛰기 시에도 메인 페이지로 이동한다
6. 온보딩 완료 여부는 사용자 프로필에 저장되어 재방문 시 표시되지 않는다
7. 온보딩은 모바일/데스크톱 모두에서 반응형으로 표시된다
8. 온보딩 진행 상태(현재 단계)를 시각적으로 표시한다
9. 온보딩 완료 시 완료율을 100%로 기록한다
10. 이미 온보딩을 완료한 사용자는 온보딩 플로우를 보지 않는다

## Tasks / Subtasks
- [ ] Task 1: 데이터베이스 스키마 확장 (AC: 6, 10)
  - [ ] users 테이블에 onboarding_completed 컬럼 추가 (boolean, default: false)
  - [ ] Drizzle Schema 업데이트
  - [ ] 마이그레이션 파일 생성 및 적용
- [ ] Task 2: 온보딩 UI 컴포넌트 구현 (AC: 2, 3, 7, 8)
  - [ ] OnboardingModal 컴포넌트 생성
  - [ ] OnboardingStep 컴포넌트 생성 (단계별 콘텐츠)
  - [ ] ProgressIndicator 컴포넌트 생성 (진행 상태 표시)
  - [ ] 다음/건너뛰기/완료 버튼 구현
  - [ ] 반응형 스타일 적용 (Tailwind CSS)
- [ ] Task 3: 온보딩 로직 구현 (AC: 1, 4, 5, 6, 9, 10)
  - [ ] 회원가입 완료 후 온보딩 페이지 리다이렉트
  - [ ] 온보딩 단계 관리 상태 구현
  - [ ] 온보딩 완료/건너뛰기 처리
  - [ ] 온보딩 완료 시 DB 업데이트 (onboarding_completed = true)
  - [ ] 메인 페이지 리다이렉트 로직
  - [ ] 온보딩 완료 여부 확인 및 조건부 렌더링
- [ ] Task 4: 온보딩 콘텐츠 작성
  - [ ] 웰컴 메시지 작성
  - [ ] 핵심 기능 소개 콘텐츠 작성
  - [ ] 첫 메모 작성 안내 콘텐츠 작성
- [ ] Task 5: 테스트 작성
  - [ ] 온보딩 UI 컴포넌트 테스트
  - [ ] 온보딩 플로우 통합 테스트
  - [ ] 온보딩 완료 상태 저장 테스트
  - [ ] 온보딩 건너뛰기 테스트
  - [ ] 반응형 레이아웃 테스트

## Dev Notes

### Previous Story Insights
Story 1.1~1.4에서 이미 구현된 내용:
- Supabase Auth 완전 구현 (회원가입, 로그인, 비밀번호 재설정, 로그아웃)
- 클라이언트 및 서버 Supabase 클라이언트 설정
- shadcn/ui 컴포넌트 사용 가능 (Button, Input, Label)
- 인증 상태 관리 및 라우팅 구현
- 회원가입 성공 후 홈페이지로 리다이렉트 (현재는 `/`)

### Data Models
- **User Profile Extension**:
  - `onboarding_completed`: boolean (기본값: false)
  - 온보딩 완료 여부를 추적
  - Supabase Auth 사용자와 연결
- **Drizzle Schema**: `/drizzle/schema.ts`에서 정의
- **Migration**: `pnpm drizzle-kit generate` 및 `pnpm drizzle-kit push`로 적용

### API Specifications
- **Supabase Auth API**:
  - `getUser()`: 현재 사용자 정보 조회
  - `updateUser()`: 사용자 메타데이터 업데이트 (온보딩 완료 상태 저장)
- **Server Actions** (필요 시):
  - `completeOnboarding()`: 온보딩 완료 처리 및 DB 업데이트
  - `skipOnboarding()`: 온보딩 건너뛰기 처리

### Component Specifications
- **OnboardingModal**:
  - Client Component (상태 관리 필요)
  - Props: isOpen, onComplete, onSkip
  - State: currentStep (1, 2, 3)
  - 모달 형태 또는 전체 화면 오버레이
- **OnboardingStep**:
  - Props: stepNumber, title, description, icon
  - 각 단계별 콘텐츠 표시
- **ProgressIndicator**:
  - Props: currentStep, totalSteps
  - 시각적 진행 상태 (예: 1/3, 2/3, 3/3)
- **UI Components**: shadcn/ui Button 사용

### File Locations
- `/drizzle/schema.ts`: 데이터베이스 스키마 정의
- `/drizzle/migrations/`: 마이그레이션 파일 생성
- `/components/onboarding/onboarding-modal.tsx`: 온보딩 모달 컴포넌트
- `/components/onboarding/onboarding-step.tsx`: 온보딩 단계 컴포넌트
- `/components/onboarding/progress-indicator.tsx`: 진행 상태 컴포넌트
- `/app/onboarding/page.tsx`: 온보딩 페이지 (또는 모달 형태로 구현 가능)
- `/app/auth/signup/page.tsx`: 회원가입 후 온보딩 페이지로 리다이렉트 수정
- `/lib/actions/onboarding.ts`: 온보딩 관련 서버 액션
- `/__tests__/onboarding/`: 온보딩 테스트 파일

### Testing Requirements
- **Unit Tests**: `/__tests__/onboarding/` 디렉토리에 테스트 파일 생성
- **Testing Framework**: Jest + React Testing Library
- **Test Coverage**: 
  - 온보딩 UI 컴포넌트 렌더링
  - 온보딩 단계 전환
  - 온보딩 완료/건너뛰기 처리
  - DB 업데이트 확인
  - 반응형 레이아웃
- **Integration Tests**: 온보딩 전체 플로우 테스트

### Technical Constraints
- **Next.js App Router**: `/app` 디렉토리 구조 사용
- **Server Actions**: 온보딩 완료 상태 서버에서 처리
- **Drizzle ORM**: 데이터베이스 스키마 및 마이그레이션
- **Supabase**: 사용자 메타데이터 또는 별도 테이블 사용
- **Tailwind CSS**: 스타일링 전용
- **shadcn/ui**: UI 컴포넌트 라이브러리
- **TypeScript**: 타입 안전성 보장

### UX Considerations
- **온보딩 시간**: 3분 이내 완료 가능하도록 간결하게 구성
- **건너뛰기 옵션**: 사용자가 온보딩을 건너뛸 수 있도록 제공
- **시각적 피드백**: 진행 상태를 명확히 표시
- **반응형 디자인**: 모바일/데스크톱 모두 최적화
- **명확한 CTA**: 다음/완료 버튼 명확히 표시

### Security Considerations
- **사용자 스코프**: 온보딩 완료 상태는 해당 사용자만 수정 가능
- **서버 액션**: 온보딩 완료 처리는 서버에서만 가능
- **인증 확인**: 온보딩은 로그인된 사용자만 접근 가능

## Testing
### Testing Standards
- **Test File Location**: `/__tests__/onboarding/` 디렉토리
- **Test Framework**: Jest + React Testing Library
- **Test Patterns**: 
  - Unit tests for onboarding UI components
  - Integration tests for onboarding flow
  - State management tests (onboarding completion)
  - Database update tests
  - Responsive layout tests
- **Coverage Requirements**: 핵심 기능 80% 이상 커버리지

## Change Log
| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-01-XX | 1.0 | 초기 스토리 생성 | Scrum Master (Bob) |

## Dev Agent Record

### Agent Model Used
*개발 에이전트가 작성*

### Debug Log References
*개발 에이전트가 작성*

### Completion Notes List
*개발 에이전트가 작성*

### File List
*개발 에이전트가 작성*

## QA Results
*QA 에이전트가 검토 후 작성*








